deployment:
  master:
    branch: master
    commands:
      - GOOS=linux  GOARCH=amd64 CGO_ENABLED=0 go build -o builds/linux/amd64/mongohq
      - shasum builds/linux/amd64/mongohq | awk '{print $1}' > builds/linux/amd64/checksum
      - GOOS=linux  GOARCH=386   CGO_ENABLED=0 go build -o builds/linux/386/mongohq
      - shasum builds/linux/386/mongohq | awk '{print $1}' > builds/linux/386/checksum
      - GOOS=darwin GOARCH=amd64 CGO_ENABLED=0 go build -o builds/darwin/amd64/mongohq
      - shasum builds/darwin/amd64/mongohq | awk '{print $1}' > builds/darwin/amd64/checksum
      - GOOS=darwin GOARCH=386   CGO_ENABLED=0 go build -o builds/darwin/386/mongohq
      - shasum builds/darwin/386/mongohq | awk '{print $1}' > builds/darwin/386/checksum
      - echo "[default]" > .s3cmd
      - echo "access_key = $KEY" >> .s3cmd
      - echo "secret_key = $SECRET" >> .s3cmd
      - echo "host_base = s3.amazonaws.com" >> .s3cmd
      - s3cmd -c .s3cmd sync builds s3://mongohq-cli/
      - s3cmd -c .s3cmd put install.sh s3://mongohq-cli/
      - rm .s3cmd
